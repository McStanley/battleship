(()=>{"use strict";class e{ship=null;#e=!1;get wasAttacked(){return this.#e}attack(){this.#e=!0}}class t{#t=Array(10).fill().map((()=>Array(10).fill().map((()=>new e))));get board(){return this.#t}placeShip(e,r,a){const o=t.calculatePlacement(e,r,a);for(let t=0;t<o.length;t+=1){const r=o[t],a=r[0],n=r[1];this.#t[a][n].ship=e}}canPlace(e,r,a){const o=t.calculatePlacement(e,r,a);for(let e=0;e<o.length;e+=1){const t=o[e],r=t[0],a=t[1];if(r<0||r>9)return!1;if(a<0||a>9)return!1;if(this.#t[r][a].ship)return!1;const n=[[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0]];for(let e=0;e<n.length;e+=1){const t=n[e],[o,c]=[t[0],t[1]];if(this.#t[r+o]?.[a+c]?.ship)return!1}}return!0}static calculatePlacement(e,t,r){const a=[];for(let o=0;o<e.length;o+=1){const e=t[0]+("horizontal"===r?o:0),n=t[1]+("vertical"===r?o:0);a.push([e,n])}return a}receiveAttack(e,t){this.#t[e][t].attack(),this.#t[e][t].ship&&this.#t[e][t].ship.hit()}get allSunk(){for(let e=0;e<this.#t.length;e+=1){const t=this.#t[e];for(let e=0;e<t.length;e+=1){const r=t[e];if(r.ship&&!r.wasAttacked)return!1}}return!0}}class r{#r;#a;#o=new t;constructor(e,t){this.#r=e,this.#a=t}get name(){return this.#r}get isHuman(){return this.#a}get gameboard(){return this.#o}static attack(e,t){const[r,a]=[t[0],t[1]];e.gameboard.receiveAttack(r,a)}}class a{#n;#c=0;constructor(e){this.#n=e}get length(){return this.#n}get hits(){return this.#c}hit(){this.#c+=1}isSunk(){return this.#c===this.#n}}const o=(e,t)=>{let r,a,o;do{r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),o=Math.random()<.5?"horizontal":"vertical"}while(!e.gameboard.canPlace(t,[r,a],o));return{location:[r,a],direction:o}},n=(e,t)=>{const{x:r,y:a}=e.dataset;return t.gameboard.board[r][a]},c=(()=>{let e,t;const n=()=>t,c=e=>{const t=[new a(5),new a(4),new a(3),new a(3),new a(2)];for(;t.length;){const r=t.shift(),a=o(e,r);e.gameboard.placeShip(r,a.location,a.direction)}};return{getActive:()=>e,getPassive:n,isOver:()=>!!t.gameboard.allSunk,togglePlayers:()=>{[e,t]=[t,e]},computerMove:()=>{const e=n();let t,r;do{t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random())}while(e.gameboard.board[t][r].wasAttacked);e.gameboard.receiveAttack(t,r)},init:(a,o,n,l)=>{e=new r(a,o),t=new r(n,l),c(e),c(t)}}})();(()=>{const e=e=>{e.replaceChildren();for(let t=0;t<10;t+=1)for(let r=0;r<10;r+=1){const a=document.createElement("div");a.classList.add("grid-cell"),a.dataset.x=r,a.dataset.y=t,e.appendChild(a)}},t=(e,t)=>{const r=t.querySelectorAll(".grid-cell");for(let t=0;t<r.length;t+=1){const a=r[t],o=n(a,e);o.wasAttacked&&(o.ship||(a.style.backgroundColor="blue"),o.ship&&(a.style.backgroundColor=o.ship.isSunk()?"purple":"red"))}},r=()=>{const r=document.querySelector("#left-grid");e(r);const a=document.querySelectorAll("#left-grid > .grid-cell"),o=c.getActive();for(let e=0;e<a.length;e+=1){const t=a[e];n(t,o).ship&&(t.style.backgroundColor="grey")}t(o,r)},a=()=>{const o=document.querySelector("#right-grid");e(o),o.style.pointerEvents="auto";const l=c.getPassive();t(l,o);const s=o.querySelectorAll(".grid-cell");for(let e=0;e<s.length;e+=1){const i=s[e];n(i,l).wasAttacked||i.addEventListener("click",(()=>{document.querySelector("#right-grid").style.pointerEvents="none",l.gameboard.receiveAttack(i.dataset.x,i.dataset.y),t(l,o),c.isOver()?alert(`${c.getActive().name} won`):(c.togglePlayers(),setTimeout((()=>{if(!c.getActive().isHuman){if(c.computerMove(),c.isOver())return alert(`${c.getActive().name} won`),c.togglePlayers(),void r();c.togglePlayers()}r(),a()}),250))}))}},o=()=>{const e=document.querySelector("#playerone-name"),t=document.querySelector("#playerone-human"),o=document.querySelector("#playertwo-name"),n=document.querySelector("#playertwo-human"),l=e.value||"Player One",s=!!t.checked,i=o.value||"Player Two",d=!!n.checked;c.init(l,s,i,d),(()=>{const e=document.querySelector(".overlay"),t=document.querySelector(".setup");e.classList.add("hidden"),t.classList.add("hidden"),(()=>{const e=document.querySelector("#playerone-name"),t=document.querySelector("#playerone-human"),r=document.querySelector("#playertwo-name"),a=document.querySelector("#playertwo-human");e.value="",t.checked=!0,r.value="",a.checked=!0})()})(),r(),a()};return{init:()=>{const t=document.querySelector("#left-grid"),r=document.querySelector("#right-grid"),a=document.querySelector("#start-btn");e(t),e(r),a.addEventListener("click",o)}}})().init()})();