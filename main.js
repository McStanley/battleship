(()=>{"use strict";class e{ship=null;#e=!1;get wasAttacked(){return this.#e}attack(){this.#e=!0}}class t{#t=Array(10).fill().map((()=>Array(10).fill().map((()=>new e))));get board(){return this.#t}placeShip(e,r,n){const o=t.calculatePlacement(e,r,n);for(let t=0;t<o.length;t+=1){const r=o[t],n=r[0],c=r[1];this.#t[n][c].ship=e}}canPlace(e,r,n){const o=t.calculatePlacement(e,r,n);for(let e=0;e<o.length;e+=1){const t=o[e],r=t[0],n=t[1];if(r<0||r>9)return!1;if(n<0||n>9)return!1;if(this.#t[r][n].ship)return!1;const c=[[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0]];for(let e=0;e<c.length;e+=1){const t=c[e],[o,a]=[t[0],t[1]];if(this.#t[r+o]?.[n+a]?.ship)return!1}}return!0}static calculatePlacement(e,t,r){const n=[];for(let o=0;o<e.length;o+=1){const e=t[0]+("horizontal"===r?o:0),c=t[1]+("vertical"===r?o:0);n.push([e,c])}return n}receiveAttack(e,t){this.#t[e][t].attack(),this.#t[e][t].ship&&this.#t[e][t].ship.hit()}get allSunk(){for(let e=0;e<this.#t.length;e+=1){const t=this.#t[e];for(let e=0;e<t.length;e+=1){const r=t[e];if(r.ship&&!r.wasAttacked)return!1}}return!0}}class r{#r;#n;#o=new t;constructor(e,t){this.#r=e,this.#n=t}get name(){return this.#r}get isHuman(){return this.#n}get gameboard(){return this.#o}static attack(e,t){const[r,n]=[t[0],t[1]];e.gameboard.receiveAttack(r,n)}}class n{#c;#a=0;constructor(e){this.#c=e}get length(){return this.#c}get hits(){return this.#a}hit(){this.#a+=1}isSunk(){return this.#a===this.#c}}const o=(e,t)=>{let r,n,o;do{r=Math.floor(10*Math.random()),n=Math.floor(10*Math.random()),o=Math.random()<.5?"horizontal":"vertical"}while(!e.gameboard.canPlace(t,[r,n],o));return{location:[r,n],direction:o}},c=(e,t)=>{const{x:r,y:n}=e.dataset;return t.gameboard.board[r][n]},a=(()=>{let e,t;const c=()=>t,a=e=>{const t=[new n(5),new n(4),new n(3),new n(3),new n(2)];for(;t.length;){const r=t.shift(),n=o(e,r);e.gameboard.placeShip(r,n.location,n.direction)}};return{getActive:()=>e,getPassive:c,isPvP:()=>e.isHuman&&t.isHuman,isOver:()=>!!t.gameboard.allSunk,togglePlayers:()=>{[e,t]=[t,e]},computerMove:()=>{const e=c();let t,r;do{t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random())}while(e.gameboard.board[t][r].wasAttacked);e.gameboard.receiveAttack(t,r)},init:(n,o,c,s)=>{e=new r(n,o),t=new r(c,s),a(e),a(t)}}})();(()=>{const e=e=>{e.replaceChildren();for(let t=0;t<10;t+=1)for(let r=0;r<10;r+=1){const n=document.createElement("div");n.classList.add("grid-cell"),n.dataset.x=r,n.dataset.y=t,e.appendChild(n)}},t=e=>{const t=document.querySelector(".overlay");e.classList.contains("hidden")!==t.classList.contains("hidden")&&t.classList.toggle("hidden")},r=()=>{const e=document.querySelector(".proceed");document.querySelector("#proceed-player").textContent=a.getActive().name,e.classList.toggle("hidden"),t(e)},n=e=>{const r=document.querySelector(".results");document.querySelector("#winner").textContent=e.name,r.classList.remove("hidden"),t(r)},o=(e,t)=>{const r=t.querySelectorAll(".grid-cell");for(let t=0;t<r.length;t+=1){const n=r[t],o=c(n,e);o.wasAttacked&&(o.ship||(n.style.backgroundColor="blue"),o.ship&&(n.style.backgroundColor=o.ship.isSunk()?"purple":"red"))}},s=()=>{const t=document.querySelector("#left-grid");e(t);const r=document.querySelectorAll("#left-grid > .grid-cell"),n=a.getActive();for(let e=0;e<r.length;e+=1){const t=r[e];c(t,n).ship&&(t.style.backgroundColor="grey")}o(n,t)},l=()=>{const t=document.querySelector("#left-grid"),i=document.querySelector("#right-grid");e(i),i.style.pointerEvents="auto";const d=a.getPassive();o(d,i);const u=i.querySelectorAll(".grid-cell");for(let h=0;h<u.length;h+=1){const g=u[h];c(g,d).wasAttacked||g.addEventListener("click",(()=>{if(document.querySelector("#right-grid").style.pointerEvents="none",d.gameboard.receiveAttack(g.dataset.x,g.dataset.y),o(d,i),a.isOver()){const e=a.getActive();n(e)}else a.togglePlayers(),setTimeout((()=>{if(!a.getActive().isHuman){if(a.computerMove(),a.isOver()){const e=a.getActive();return n(e),a.togglePlayers(),void s()}a.togglePlayers()}if(a.isPvP())return e(t),e(i),void r();s(),l()}),500)}))}},i=()=>{const e=document.querySelector(".setup");e.classList.toggle("hidden"),t(e),e.classList.contains("hidden")&&(()=>{const e=document.querySelector("#playerone-name"),t=document.querySelector("#playerone-human"),r=document.querySelector("#playertwo-name"),n=document.querySelector("#playertwo-human");e.value="",t.checked=!0,r.value="",n.checked=!0})()},d=()=>{const e=document.querySelector("#playerone-name"),t=document.querySelector("#playerone-human"),n=document.querySelector("#playertwo-name"),o=document.querySelector("#playertwo-human"),c=e.value||"Player One",d=!!t.checked,u=n.value||"Player Two",h=!!o.checked;a.init(c,d,u,h),i(),a.isPvP()?r():(s(),l())},u=()=>{const t=document.querySelector("#left-grid"),r=document.querySelector("#right-grid"),n=document.querySelector(".results");e(t),e(r),n.classList.add("hidden"),i()},h=()=>{r(),s(),l()};return{init:()=>{const e=document.querySelector("#start-btn"),t=document.querySelector("#proceed-btn"),r=document.querySelector("#restart-btn");e.addEventListener("click",d),t.addEventListener("click",h),r.addEventListener("click",u),u()}}})().init()})();